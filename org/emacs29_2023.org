#+TITLE: 2023 äº†, è¯•è¯• emacs 29
#+DATE: <2023-01-02 ä¸€>
#+OPTIONS: toc:1

2023 äº†, å…ƒæ—¦å‡æœŸ, æƒ³ä½“éªŒä¸€ä¸‹æ–°ç‰ˆæœ¬çš„ emacs, æˆ‘å·²ç»çœ¼é¦‹å¥½ä¹…äº†
å‘è¡Œç‰ˆè¿˜æ²¡æä¾›? è‡ªå·±ç¼–è¯‘, è€Œä¸”è‡ªå·±ç¼–è¯‘å¯ä»¥è‡ªå®šä¹‰ä¸€äº›é€‰é¡¹, æ¯”å¦‚ pgtk
å®Œæ•´çš„æ–°ç‰¹æ€§å»çœ‹ =etc/NEWS= (btw, =emacs-news-mode= ä¹Ÿæ˜¯æ–°åŠ çš„)

* build emacs (with musl?)
gcc (it's GNU emacs, so...) å‚æ•°æ¥æº:
- https://zhuanlan.zhihu.com/p/172518559
- https://snoopitek.com/make.conf

don't run this in fish, use bash or ksh instead
#+BEGIN_SRC bash
./configure CFLAGS="-march=native -O3 -pipe -fno-math-errno -fgraphite-identity -floop-nest-optimize -fno-semantic-interposition -fno-strict-aliasing -fno-common -fipa-pta -fno-plt" \
            LDFLAGS="-L`jemalloc-config --libdir` -Wl,-rpath,`jemalloc-config --libdir` -ljemalloc `jemalloc-config --libs`" \
            --with-x=no \
            --with-gpm=no \
            --with-pgtk \
            --with-native-compilation \
            --with-json \
            --with-sqlite3 \
            --with-tree-sitter \
            --with-webp \
            --with-gif \
            --with-rsvg
#+END_SRC

@@html:<details>@@
@@html:<summary>but what about musl? (CC=musl-gcc)</summary>@@
#+BEGIN_SRC text
checking whether GTK compiles... no
configure: error: Gtk+ wanted, but it does not compile, see config.log.
#+END_SRC

#+BEGIN_SRC text
<dongdigua> hello, I tried to build emacs with musl-gcc, but it says:
<dongdigua> error: Gtk+ wanted, but it does not compile
<dongdigua> it can build using normal gcc
<dongdigua> and it can build on voidlinux
<sam_> dalias: <3
<dongdigua> o_O
<sam_> dongdigua: you'd have to share some logs in full for us to help at all
<sam_> but you'd be better off asking your Linux distribution
<dongdigua> it is mostly `ld: error: unable to find library`
<dongdigua> sam_: so i think it is probably something about the wrapper script
<heat> musl-gcc (does not? should not?) pick up on host libraries because they
       were built against glibc and not musl
<heat> so musl-gcc will not pick up on those
<heat> or at least they will just not work and will break configure
<dongdigua> heat: so I should use those libraries that is built on musl?
<dongdigua> like voidlinux I mentioned above
<heat> yes
<dongdigua> ok
ERC>
#+END_SRC
@@html:</details>@@

* dump?
ç°åœ¨å¼€å¯ =native-comp= æ—¶ =dump-emacs-portable= æ²¡æ³•å¼„, è§: [[https://emacs-china.org/t/emacs-29-with-native-comp-dump/22762][emacs china: emacs 29 with native-comp æ— æ³• dump]]
+è¯•ç€ä¸å¼€ native-comp dump äº†ä¸€ä¸‹, ä¹Ÿå°±åŠ å¿«äº† 0.2s, è€Œä¸”æœ‰å„ç§é—®é¢˜, ç®—å•¦ç®—å•¦+
ä½œä¸ºä¸€ä¸ªè¿½æ±‚æè‡´çš„äºº, æ€ä¹ˆèƒ½ç®—äº†! ä¸èƒ½ dump å·²ç» dump çš„ emacs, é‚£å°±æ”¾åˆ°ç¬¬ä¸€æ­¥çš„ dump é‡Œ.
åœ¨ [[https://git.savannah.gnu.org/cgit/emacs.git/tree/INSTALL#n516][INSTALL]] æ–‡ä»¶é‡Œè¯´äº†, è‡ªå®šä¹‰çš„é…ç½®æ”¾åœ¨ =site-init.el=
æˆ‘æŠŠä¸€äº›å¿…è¦çš„é…ç½®ç”¨ =;;;ifdef dump= =;;;endif= åŒ…ä¸Š, ç„¶åéšä¾¿å†™ä¸€ä¸ª[[https://github.com/dongdigua/configs/blob/main/epp.ex][è„šæœ¬]], åªä¿ç•™ä¹‹é—´çš„éƒ¨åˆ†.

è¿™äº› "å¿…è¦çš„é…ç½®" æ˜¯ä¸»è¦ GUI ç›¸å…³çš„å’Œä¸é¡»è¦é¢å¤–åŒ…çš„é…ç½®,
dump GUI çš„é…ç½®å¾ˆå¥½, ä¹‹å‰ä¼šçœ‹åˆ° çª—å£ç¼©æ”¾ä»¥åŠ tool-bar å’Œ menu-bar ä¸€é—ªè€Œè¿‡, ç°åœ¨å¥½äº†.
(GUI æ¨¡å¼) è¿™ä¸ºæˆ‘èŠ‚çœäº† (0.8 - 0.6)s å’Œ(14 - 12)æ¬¡ gc

btw, åæ¥æˆ‘ç”¨ =(setq use-package-verbose t)= æ‰¾å‡ºæ¥äº†ä¸€ä¸ªæˆ‘ä¸€ç›´ä¸å’‹ç”¨ä½†æ˜¯è¿˜å¯åŠ¨æ—¶åŠ è½½çš„åŒ…: ement,
åŠ ä¸Šå¦å¤–å‡ ä¸ªåŒ…ä¹Ÿéƒ½ defer, é™åˆ° 0.4s äº†

* æˆ‘ æœ‰åˆ‡èº«ä½“ä¼š/è¿˜æ²¡ä½“éªŒä½†æ˜¯è®¤ä¸ºå¾ˆä¸é”™ çš„æ–°ç‰¹æ€§
** [[https://emacs-china.org/t/emacs/19806]["çœŸ" èƒŒæ™¯é€æ˜]]
è¿™æ˜¯æˆ‘æå‰äº†è§£åˆ°çš„ç¬¬ä¸€ä¸ª emacs29 ç‰¹æ€§, [[https://www.bilibili.com/video/BV1ca41127KY][evan çš„è§†é¢‘]]
ä½†æ˜¯æœ‰é€æ˜é€šé“çš„å›¾ç‰‡ä¸ä¼šè·Ÿç€é€æ˜

** [[https://www.emacswiki.org/emacs/SmoothScrolling][å¹³æ»‘æ»šåŠ¨]]
æœç´¢ emacs29 è¹¦å‡ºæ¥çš„

** elisp-byte-compile-file

** emoji ğŸ˜€

** package-vc-install
ä½†æ˜¯ =package-report-bug= æœ‰ç‚¹è¿·æƒ‘

* æˆ‘è®¤ä¸ºæ—©å°±è¯¥åŠ äº†ä½†æ˜¯ç°åœ¨æ‰åŠ å…¥
** erc-sasl
æˆ‘ç¼–è¯‘çš„æ—¶å€™å¶ç„¶å‘ç°çš„ =erc-sasl.el=
æˆ‘å»! ç»ˆäºæœ‰ sasl äº†! ä¸ç”¨ç¬¬ä¸‰æ–¹çš„ [[https://github.com/emacs-circe/circe][circe]] äº†!
*åªéœ€è¦ customize =erc-modules= åŠ å…¥ sasl, ç„¶åç”¨ =erc-tls= å°±æˆäº†*
è¿™ä¸ªæœ€æ—© 12 å¹´å°±æœ‰äººæå‡ºäº† ([[https://lists.gnu.org/archive/html/erc-discuss/2012-02/msg00001.html][æ³¨é‡Šé‡Œç»™çš„é“¾æ¥]])

** restart-emacs

** package-update(-all)

* 29.1
- =use-package=
- more =*-ts-mode=
