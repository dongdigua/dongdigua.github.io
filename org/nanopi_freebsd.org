#+TITLE: åœ¨ NanoPi R2S ä¸Šè¿è¡Œ FreeBSD
#+DATE: <2023-07-10 ä¸€>

æ›¾ç»æœ‰ä¸¤ä¸ªæ ‘è“æ´¾, Pi3 å› ä¸ºç¢°æ°´, Zero å› ä¸ºè…èš€, éƒ½æŠ¥åºŸäº†

æˆ‘æƒ³åœ¨ R2S ä¸Šè¿è¡Œ BSD, å› ä¸º:
1) it's cool 2) base system è¶³å¤Ÿ, åªéœ€è¦å®‰è£…å°‘é‡åŒ… 3) ç®€æ´, é€‚åˆå°è®¾å¤‡

* è‰°è¾›çš„å†ç¨‹
- å¸¦ä¸Šæ‰‹å¥—é˜²æ­¢è…èš€, ç”¨èºä¸åˆ€å’Œå¼¯å¤´é•Šå­ (æ–‡å…·ç›’é‡Œéšæ‰‹ä½¿ç”¨) æ’¬å¼€å¤–å£³
- ç¼åˆäº†ä¸€ä¸ª OpenBSD é•œåƒ, ç”¨ Arduino Uno å½“ä¸²å£è¿æ¥ UART, è¾“å‡ºæ¯«æ— æ„ä¹‰çš„å­—ç¬¦
- è¿è¡Œ OpwnWRT, ä¾æ—§è¾“å‡ºåƒåœ¾
- è¿è¡Œ Armbian, ä¾æ—§è¾“å‡ºåƒåœ¾, å¼¹äº†ä¸€ä¼šç´åå¼€å§‹æ€è€ƒæ˜¯ä¸æ˜¯ä¸²å£å‡ºé”™äº†
- ç¿»ç®±å€’æŸœæ‰¾åˆ°ä¸€ä¸ª USB Mini-B çº¿ç”¨äº å±±å¯¨ç‰ˆ Arduino Nano (CH340 èŠ¯ç‰‡)
- é‡æ–°çƒ§å†™ OpenBSD é•œåƒ, æˆåŠŸå¯åŠ¨, ä½†é”®ç›˜æ— æ³•è¾“å…¥, æ— æ³•å®‰è£…
- ç¼åˆ FreeBSD é•œåƒ, æˆåŠŸå¯åŠ¨, ssh ç™»å½• (user/passwd:freebsd), è€¶!
- åˆä¸Šå¤–å£³

** å…³äºé•œåƒåˆ¶ä½œ
- [[https://personalbsd.org][PersonalBSD.org]] ä½†æ˜¯æ„å»ºè¿‡ç¨‹ä¸çŸ¥é“, ä¸æ•¢ç”¨
- [[https://asciinema.org/a/381979][asciinema: NanoPi r2s RK3328 with FreeBSD 13-CURRENT]]
- [[https://asciinema.org/a/381973][asciinema: NanoPi r2s RK3328 with OpenBSD 6]]

æ€»çš„æ¥è¯´å°±æ˜¯:
#+BEGIN_SRC sh
dd if=FreeBSD-13.2-RELEASE-arm64-aarch64-ROCK64.img of=root.img bs=1M
dd if=usr/lib/linux-u-boot-edge-nanopi-r2s_22.05.3_arm64/idbloader.bin of=root.img seek=64 conv=notrunc
dd if=usr/lib/linux-u-boot-edge-nanopi-r2s_22.05.3_arm64/uboot.img of=root.img seek=16384 conv=notrunc
dd if=usr/lib/linux-u-boot-edge-nanopi-r2s_22.05.3_arm64/trust.bin of=root.img seek=24576 conv=notrunc
doas dd if=root.img of=/dev/sda
#+END_SRC


* å¼€å§‹
- ä¸­å›½ç”¨æˆ·ç¬¬ä¸€ä»¶äº‹å…ˆæ¢æº: [[https://mirror.bjtu.edu.cn/help/freebsd/][bjtu FreeBSD é•œåƒ]]
- ç„¶ååƒä¹‹å‰ [[./whatif_openbsd.org][OpenBSD]] ä¸€æ ·è¿˜æ˜¯è£…æœºå¿…å¤‡è½¯ä»¶, å› ä¸ºæ˜¯æœåŠ¡å™¨æ‰€ä»¥æ²¡å‡ ä¸ª
#+BEGIN_SRC sh
pkg install neofetch oksh sudo git fzf frp
#+END_SRC
- æ”¹å¯†ç , =/usr/local/etc/sudoers=
  ä¸ç”¨ doas å› ä¸º persist é€‰é¡¹åªåœ¨ OpenBSD ä¸Šå¯ç”¨
- ä¸»æœºå, è·¯ç”±å™¨é…ç½® DHCP é™æ€ IP, æœ¬æœº =/etc/hosts= åŠ å…¥ä¸»æœºåè§£æ
#+BEGIN_SRC sh
hostname freebsd-r2s
vi /etc/rc.conf
#+END_SRC
- æ”¹ shell é…ç½®, [[https://github.com/dongdigua/configs/blob/main/.profile.in][åŸºæœ¬è¿˜æ˜¯ä¹‹å‰é‚£æ ·]]
åœ¨ fortune é‡Œçœ‹åˆ°ä¸€ä¸ªä¸é”™çš„ PS1, å¼„ä¸ªæ–° PS1 æ¢æ¢å£å‘³
#+BEGIN_SRC sh
PS1='(\[$(tput md)\]\t <\w>\[$(tput me)\]) $(echo $?) \[\033[01;31m\]ïŒŒ\[\033[00m\] '
#+END_SRC
- HZ? åœ¨ Linux ä¸Šé™ä½ HZ æ˜¯èƒ½å‡å°‘èƒ½è€—çš„, ä½†è¿™é‡Œè‡³å°‘æ¸©åº¦æ²¡é™, å…ˆæ”¹æˆ 250 å§ =/boot/loader.conf=
- é™ CPU é¢‘ç‡æ˜¯å½“ç„¶èƒ½å‡å°‘èƒ½è€—çš„ =/etc/sysctl.conf=

* ç¬¬ä¸€ä¸ªæœåŠ¡: gopher
#+BEGIN_SRC sh
su
# freecolor ç”¨äº https://github.com/dongdigua/dongdigua.github.io/blob/main/gmi/docker/cgi/stat.cgi
pkg add gophernicus freecolor
vi /etc/inetd.conf
echo 'inetd_enable="YES"' >> /etc/rc.conf
mkdir /var/gopher
# don't also chown nobody group so it belongs to wheel group
chown nobody /var/gopher
chmod 775 /var/gopher
service inetd onestart
#+END_SRC

* frpc daemon
frp è¿™å®Œæ„å¥½å•Š, ä½†æ˜¯ [[https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1030841][Debian æç½®äº†æŒºé•¿æ—¶é—´]]ä¹Ÿæ²¡åŠ å…¥
æˆ‘ä½œä¸º RHEL7 å…¥å‘ Linux çš„ç”¨æˆ·, æ²¡æœ‰ä½“éªŒè¿‡ systemd ä¹‹å‰çš„æœåŠ¡ç®¡ç†, è¿™é‡Œå¯ä»¥ä½“éªŒä¸€æŠŠ.
æœ¬æ¥ä»¥ä¸ºè¿˜å¾—å­¦ rc è„šæœ¬, ç»“æœæŠŠåŒç›®å½•çš„ frps æ”¹æ”¹å°±è¡Œäº†
#+BEGIN_SRC sh
cd /usr/local/etc/rc.d
cp frps frpc
sed -i '' 's/frps/frpc/g' frpc
#+END_SRC
åˆ«å¿˜äº†æŠŠ gophernicus çš„ host å’Œ port æ”¹æˆè¿œç¨‹ä¸»æœºçš„

** SSH å‘½æ ¹å­
æœ‰æ—¶æƒ³åŠ ä¸€ä¸ªç«¯å£è½¬å‘, ç„¶åä¸€ restart, SSH ä¹Ÿæ–­äº†, æ‰€ä»¥åº”è¯¥æŠŠ SSH è½¬å‘åˆ†å¼€æ¥å•ç‹¬ä¸€ä¸ªæœåŠ¡

* git æœåŠ¡å™¨
æœ¬æ¥æƒ³å¼„ä¸ª ssh git å’Œ cgit, ä½†ä»”ç»†è€ƒè™‘æ„Ÿè§‰æ²¡æœ‰å•¥ç”¨, æˆ‘çš„ repo éƒ½æ‰˜ç®¡åœ¨æˆ‘æœ‹å‹çš„æœåŠ¡å™¨ä¸Š.
åˆæƒ³å¼„ä¸ª sourcehut, ä½†çœŸçš„å¤ªéº»çƒ¦äº†.
é‚£ä¸å¦‚å¼„ä¸ª gitea, æµ‹è¯•ä¸€ä¸‹ä¸€äº›å¥‡æ€ªçš„åŠŸèƒ½, å†åšä¸€ä»½é•œåƒ.
å¾ˆé‡è¦çš„ä¸€ç‚¹: =HTTP_ADDR= åº”è®¾ç½®æˆ 0.0.0.0

è¿™ç§æ¯”è¾ƒå¤§çš„æœåŠ¡å¯ä»¥æ”¾åœ¨ jail é‡Œ, å‚è€ƒ Absolute FreeBSD

* jail(8)
é€šç”¨ jail è®¾ç½®:
** ä¸»æœº
=/etc/jail.conf=
#+BEGIN_SRC conf
exec.clean;
exec.start="sh /etc/rc";
exec.stop="sh /etc/rc.shutdown";
mount.devfs;
#+END_SRC

** in-jail
=/etc/crontab= å–æ¶ˆ save-entropy å’Œ adjkerntz
=/etc/rc.conf= è¿›ç¨‹è¶Šå°‘è¶Šå¥½, ä¼¼ä¹æˆ‘ä¸éœ€è¦ sendmail
#+BEGIN_SRC conf
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"
#+END_SRC

** rm: Operation not permitted
#+BEGIN_SRC sh
chflags -R noschg file/folder
#+END_SRC

* microbin
è¶³å¤Ÿ micro, ä¸éœ€è¦ jail
ç»ˆäº[[https://cgit.freebsd.org/ports/commit/?id=3083ea7074cf7d5dce8ad64ea6779e824c28bde0][æ›´æ–° 2.0]] äº†, è™½ç„¶æ²¡åˆ° quarterly, ä½†å¯ä»¥ =pkg add <url>= å®‰è£…

* Gemini
æ›¾ç»æˆ‘çš„ Gemini æ˜¯ç”¨ Docker è·‘åœ¨æœ‹å‹çš„æœåŠ¡å™¨ä¸Š, ä½†æ˜¯ä¸€å‡ºé—®é¢˜è°ƒè¯•å¾ˆè´¹åŠ².
ç°åœ¨æœ‰ä¸ªç¨³å®šçš„æœåŠ¡å™¨, å°±å¯ä»¥æœ¬åœ°è·‘, çœå»è®¸å¤šéº»çƒ¦.

ä¾æ—§ä½¿ç”¨ jail
#+BEGIN_SRC sh
su
pkg -j gemini install gmid git # python39 and perl5 are included in git
jexec -U root gemini git clone https://github.com/dongdigua/dongdigua.github.io.git --depth 1 /dongdigua.github.io
jexec -U root gemini sh
#+END_SRC
then run in sh:
#+BEGIN_SRC sh
cd /dongdigua.github.io
git config --global filter.dater.smudge 'perl -pe "\$last_date = `git log --pretty=format:\\"%ad\\" -1`;s/\\\$Date\\\$/\\\$Date: \$last_date\\\$/"'
git config --global filter.dater.clean 'perl -pe "s/\\\$Date[^\\\$]*\\\$/\\\$Date\\\$/"'
openssl req -x509 -newkey rsa:4096 -nodes             \
        -out /usr/local/etc/ssl/gmid/localhost.crt      \
        -keyout /usr/local/etc/ssl/gmid/localhost.key   \
        -subj "/CN=localhost"

openssl req -x509 -newkey rsa:4096 -nodes             \
        -out /usr/local/etc/ssl/gmid/example.com.crt      \
        -keyout /usr/local/etc/ssl/gmid/example.com.key   \
        -subj "/CN=example.com"
#+END_SRC

=/usr/local/etc/gmid.conf=:
#+BEGIN_SRC conf
user "_gmid"

server "freebsd-r2s" {
        root "/dongdigua.github.io"
        cert "/usr/local/etc/ssl/gmid/localhost.crt"
        key  "/usr/local/etc/ssl/gmid/localhost.key"

        cgi "/cgi/*"
        default type "text/plain"
}

server "example.com" {
        root "/dongdigua.github.io"
        cert "/usr/local/etc/ssl/gmid/example.com.crt"
        key  "/usr/local/etc/ssl/gmid/example.com.key"

        cgi "/cgi/*"
        default type "text/plain"
}
#+END_SRC

=/etc/periodic/daily/update-git=:
#+BEGIN_SRC sh
#! /bin/sh

cd /dongdigua.github.io
git pull --rebase
python3.9 misc/mdlist2gmi.py > posts.gmi
cp -r gmi/docker/cgi .
rm index.gmi
git checkout -- index.gmi
#+END_SRC

* pf
æˆ‘å”¯ä¸€èƒ½æ§åˆ¶æœºå™¨çš„æ–¹å¼å°±æ˜¯ SSH, ä½¿ç”¨ pf å¯èƒ½ä¼šæœ‰å±é™©.
åæ­£æœåŠ¡å™¨æ˜¯åœ¨å†…ç½‘, åªæœ‰å°‘æ•°æœåŠ¡é€šè¿‡è½¬å‘æš´éœ²å‡ºå».

* samba
å¼„ç€ä¸ªç”µå­åƒåœ¾ 64G Uç›˜, æƒ³æ¶ä¸ª Samba
è¦å®‰å¥½å¤šè½¯ä»¶åŒ…, æœæ–­å¼€ jail
=security = share= åœ¨ 4.x ç‰ˆæœ¬è¢«ç§»é™¤äº†, æ³¨æ„ä¸‹
samba åˆ†ä¸º smbd, nmbd, winbindd.
æˆ‘åªç”¨ smbd, ä½†æ˜¯è·‘èµ·æ¥å‘ç°å…‰æ˜¯ smbd å°±å ç”¨äº† 1G çš„ 25%, 15%, 15%, å¤ªè€—èµ„æºäº†.

æ‰€ä»¥è¿™ä½¿æˆ‘å¿…é¡»å¾—ç”¨ port ç²¾ç®€åŠŸèƒ½äº†.
ç„¶åè§£å‹ ports tree çš„æ—¶å€™æ­»æœºäº†, æ‹”ç”µç„¶åæ–‡ä»¶ç³»ç»Ÿåäº†...

è¿˜æ˜¯ NFS å§, Need For Speed, åæ­£æˆ‘åˆä¸ç”¨ Windows.
è‡³äºæƒé™, -mapall=freebsd å°±è¡Œ

* LED
:PROPERTIES:
:CUSTOM_ID: led
:END:
æ­»æœºè¿™ä¸€æ•™è®­ä½¿æˆ‘æ„è¯†åˆ°å¿…é¡»å¾—æœ‰ä¸€ä¸ªä¸ç”¨ç½‘ç»œçš„æ–¹å¼è§‚å¯ŸæœåŠ¡å™¨çŠ¶æ€, æ­£å¸¸ LED æ˜¯å¸¸äº®çš„, ä½†æ­»æœºä¹Ÿäº®ç€.
å…ˆå†™ä¸€ä¸ª blink, å°±åƒ Arduino å…¥é—¨é‚£æ ·.

...å¤ªæ— è¶£äº†, ä¸æ˜¯å—. æˆ‘çœ‹ led(4) çš„æ—¶å€™å‘ç° morse(6) æœ‰æ„æ€, äºæ˜¯å°±å†™äº†ä¸€ä¸ªç”¨æ‘©æ–¯ç æ‰“å°æ¸©åº¦å’Œå†…å­˜çš„ rc
#+BEGIN_SRC sh
#!/bin/sh

# PROVIDE: blink
# KEYWORD: shutdown

. /etc/rc.subr

name=blink
rcvar=blink_enable
blink_enable=${blink_enable:-"NO"}

start_cmd="${name}_start &"
stop_cmd="morse -l sos > /dev/led/nanopi-r2s\:red\:sys"

blink_start() {
while true
do
        echo 0 > /dev/led/nanopi-r2s\:red\:sys
        morse -l "$(sysctl -n hw.temperature.CPU | cut -c 1-2)" > /dev/led/nanopi-r2s\:red\:sys
        sleep 60
done
}

load_rc_config $name
run_rc_command "$1"
#+END_SRC

* obhttpd?
httpd å…¶å®ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¹´è½»çš„è½¯ä»¶, [[https://www.openbsd.org/papers/httpd-asiabsdcon2015.pdf][è¿™é‡Œ]]æœ‰å…³äºä¸ºä»€ä¹ˆ OpenBSD è¦è‡ªå·±åšä¸€ä¸ª Web Server çš„å†å²
é‡è½½é…ç½®:
#+BEGIN_SRC sh
sudo pkill -HUP obhttpd
#+END_SRC

å½“æˆ‘å¼„ [[https://bluemap.bluecolored.de/wiki/webserver/ExternalWebserversFile.html][BlueMap]] çš„æ—¶å€™, å‘ç°åªæœ‰ gzip å‹ç¼©æ–‡ä»¶çš„æ—¶é—´æ¯”åŸæ–‡ä»¶æ–°çš„æ—¶å€™æ‰ä¼šåŠ ä¸Š =Content-Encoding: gzip=
ä½†æ˜¯, BlueMap è¿™ç§ä¸œè¥¿åªæœ‰ .gz æ–‡ä»¶, æ‰€ä»¥å°± 404, httpd ä¹Ÿæ²¡æœ‰æ‰‹åŠ¨åŠ  header çš„æ–¹å¼.

*nginx, å¯åŠ¨!*

* [[https://www.mediawiki.org/wiki/Manual:Running_MediaWiki_on_FreeBSD][MediaWiki]]?
don't
å¦‚æœä½ ä¸æƒ³è¢«åµŒå…¥å¼è®¾å¤‡ç³Ÿç³•çš„æ€§èƒ½æµªè´¹ä¸€ä¸Šåˆçš„æ—¶é—´æœ€åå¾—åˆ°åŠ è½½æ—¶é—´å¤§äº10ç§’çš„ç½‘é¡µ, æ”¾å¼ƒå§...
æœ‰è¶³å¤Ÿæ€§èƒ½çš„æœåŠ¡å™¨è¿˜å¯ä»¥ç¼–è¯‘å¸¦ SQLite æ”¯æŒçš„ port

æˆ‘æƒ³ä½¿ç”¨ MediaWiki ä¸»è¦æƒ³å°è¯• MinecraftWiki [[https://minecraft.fandom.com/wiki/Module:Schematic][Schematic Module]]

* Avahi
æ…¢

* nginx
ç”±äºé»˜è®¤çš„ nginx autoindex å¤ªéš¾çœ‹, æˆ‘æƒ³ç”¨ [[https://github.com/aperezdc/ngx-fancyindex][fancyindex]] ä½†æ˜¯é»˜è®¤å®‰è£…é‡Œåˆæ²¡å¸¦.
åæ­£å¾—è‡ªå·±ç¼–è¯‘, é‚£ä¸å¦‚ç”¨ ports ç¼–è¯‘ä¸€ä¸ª.
å…¶å® apache çš„ autoindex æŒºå¥½, è¿˜å¸¦ icon, ä½†æ˜¯ apache çš„é…ç½®æˆ‘çœŸçš„å—ä¸äº†.
ä¹‹å‰æœ‰ä¸€æ¬¡ç”¨ portsnap(8) è§£åŒ… ports ç»“æœå´©äº†, è¿™å›ç”¨ git, æ²¡äº‹.

é»˜è®¤çš„ fancyindex é¢œè‰²æœ‰ç‚¹ä¸‘, å†™ä¸ª patch æ”¹ä¸€ä¸‹ (èƒ½ inline å°±ä¸åŠ  CSS)
æ ¹æœ¬ä¸ç”¨çœ‹ doc, ç›´æ¥å‡­ç›´è§‰ç…§çŒ«ç”»è™, å…ˆåœ¨ =Makefile.extmod= é‡Œé¢åŠ ä¸Š
#+BEGIN_SRC makefile
HTTP_FANCYINDEX_EXTRA_PATCHES=  ${PATCHDIR}/extra-patch-nginx-http-fancyindex-css
#+END_SRC
é¢œè‰²åŸºæœ¬ä¸Šæ˜¯ aur.archlinux.org, Arch Blue æ˜¯[[https://bbs.archlinux.org/viewtopic.php?id=110936][è¿™ä¸ªå¸–å­]], #39c5bb æ‡‚çš„éƒ½æ‡‚.
#+BEGIN_CENTER
archlinux.org      #08c
wiki.archlinux.org #0077bb
bbs.archlinux.org  #07b
aur.archlinux.org  #07b
#+END_CENTER
#+BEGIN_SRC diff
--- ../ngx-fancyindex-0.5.2/template.h.orig     2021-10-28 19:28:07.000000000 +0000
+++ ../ngx-fancyindex-0.5.2/template.h  2023-08-30 11:36:48.142878000 +0000
@@ -9,9 +9,8 @@
 "body,html {"
 "background:#fff;"
-"font-family:\"Bitstream Vera Sans\",\"Lucida Grande\","
-"\"Lucida Sans Unicode\",Lucidux,Verdana,Lucida,sans-serif;"
+"font-family:monospace;" 
 "}"
 "tr:nth-child(even) {"
-"background:#f4f4f4;"
+"background:#e4eeff;"
 "}"
 "th,td {"
@@ -21,5 +20,5 @@
 "text-align:left;"
 "font-weight:bold;"
-"background:#eee;"
+"background:#ecf2f5;"
 "border-bottom:1px solid #aaa;"
 "}"
@@ -29,8 +28,9 @@
 "}"
 "a {"
-"color:#a33;"
-"}"
-"a:hover {"
-"color:#e33;"
+"text-decoration:none;"
+"color:#1793d1;"
+"}" 
+"a:hover {" 
+"color:#39c5bb;"
 "}"
 "</style>"
#+END_SRC

æˆ‘ç”šè‡³è¿˜å¯ä»¥æŠŠ IPv6, SSL, MAIL, STREAM çš„åŠŸèƒ½é€šé€šå»æ‰, å› ä¸ºæˆ‘çš„ç¯å¢ƒç”¨ä¸åˆ°.

* ZFS?
ä¹‹å‰æˆ‘åªæ˜¯åœ¨å”¯ä¸€çš„Uå£ä¸Šæ’äº†ä¸€ä¸ª 32G Uç›˜, ä½†éšç€æˆ‘åœ¨æœåŠ¡å™¨ä¸Šæ”¾çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šå¹¶è¶Šæ¥è¶Šä¾èµ–å®ƒ,
æˆ‘å¼€å§‹å¯¹æ•°æ®å®‰å…¨æ‹…å¿§: ä¸‡ä¸€å“ªå¤©æ•´ä¸ªUç›˜åäº†å‘¢? è€Œä¸”è¿™ä¼¼ä¹æ­£åœ¨å‘ç”Ÿç€, æˆ‘å·²ç»çœ‹åˆ°è¿™æ ·çš„æŠ¥é”™äº†:
#+BEGIN_EXAMPLE
(da1:umass-sim1:1:0:0): CAM status: CCB request completed with an error
(da1:umass-sim1:1:0:0): Retrying command, 1 more tries remain
#+END_EXAMPLE
æ‰€ä»¥æˆ‘è€ƒè™‘ç”¨ ZFS ç»„ä¸ª RAIDz, è¿™æ · 3 å— 32G Uç›˜å¯ä»¥å¾—åˆ°æ¥è¿‘ 64G çš„ç©ºé—´å¹¶ä¸”å…è®¸ä¸€ä¸ªUç›˜åæ‰.
åˆ›å»ºå­˜å‚¨æ± ç­‰åŸºæœ¬æ“ä½œè¯·çœ‹ [[https://docs.freebsd.org/en/books/handbook/zfs/][Chapter 22. The Z File System (ZFS)]]
å¼„å®Œæˆ‘å°±å¼€å¿ƒåœ°ç¡è§‰äº†, åå°æŠŠä¹‹å‰Uç›˜çš„ä¸œè¥¿ =rsync= è¿‡æ¥, å¯»æ€è¿™ä¹ˆå…ˆè¿›çš„æ–‡ä»¶ç³»ç»Ÿä¸ä¼šå‡ºä»€ä¹ˆé—®é¢˜å§, å³ä½¿æœ‰ä¹Ÿèƒ½è‡ªæˆ‘ä¿®å¤.
ç¬¬äºŒå¤©ä¸€æ—©é†’æ¥, DEGRADED, ä¸€ä¸ªç›˜æ‰äº†, æŸ¥çœ‹ dmesg, åˆæ˜¯å¤§é‡çš„æŠ¥é”™:
#+BEGIN_EXAMPLE
(da1:umass-sim1:1:0:0): Retrying command, 0 more tries remain
(da1:umass-sim1:1:0:0): SYNCHRONIZE CACHE(10). CDB: 35 00 00 00 00 00 00 00 00 00 
(da1:umass-sim1:1:0:0): CAM status: CCB request completed with an error
(da1:umass-sim1:1:0:0): Error 5, Retries exhausted
(da1:umass-sim1:1:0:0): got CAM status 0x44
(da1:umass-sim1:1:0:0): fatal error, failed to attach to device
da1 at umass-sim1 bus 1 scbus1 target 0 lun 0
da1: <Netac OnlyDisk 2.00>  s/n 8355111095836336751 detached
(da1:umass-sim1:1:0:0): Periph destroyed
#+END_EXAMPLE
å˜¶~ ä¸åº”è¯¥å‘€, æ–°ä¹°çš„ç›˜. æ‹”æ‰å°è¯•ä¿®å¤ä»¥åŠå‡ æ¬¡é‡å¯å’Œé‡æ–°åˆ›å»ºé˜µåˆ—å, è¿˜æ˜¯è¿‡ä¸€æ®µæ—¶é—´ä¸‰ä¸ªç›˜ä¸­å°±ä¼šæœ‰ 1~2 ä¸ªåçš„.
å› ä¸ºä¹‹å‰çš„ç›˜ä¸€ç›´æ²¡å, æ‰€ä»¥å¯ä»¥æ’é™¤ USB é›†çº¿å™¨çš„é—®é¢˜, æ‰€ä»¥é—®é¢˜å°±å‡ºåœ¨ *æœ—ç§‘äº¬ä¸œè‡ªè¥æ——èˆ°åº—* ä¸Šä¹°çš„è¿™ä»¨ç›˜.
ä¸Š #archlinux-cn-offtopic é—®ä¸€åœˆ:
#+BEGIN_EXAMPLE
18:27 <digua> å„ä½, æœ—ç§‘äº¬ä¸œè‡ªè¥æ——èˆ°åº— çš„Uç›˜è´¨é‡æ€ä¹ˆæ ·å•Š, æˆ‘ä¹°äº† 3 ä¸ª, ç»„ ZFS åäº†ä¿©
...
18:28 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] > <@matterbridge:nichi.co> [digua] å„ä½, æœ—ç§‘äº¬ä¸œè‡ªè¥æ——èˆ°åº— çš„Uç›˜è´¨é‡æ€ä¹ˆæ ·å•Š, æˆ‘ä¹°äº† 3 ä¸ª, ç»„ ZFS åäº†ä¿©
18:28 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] ã€‚ã€‚ã€‚ã€‚ã€‚
18:28 <nichi_bot> [gauge] u ç›˜è¿˜è¦ zfs å˜›
18:28 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] ä½ ä¸çŸ¥é“ U ç›˜ç”¨çš„æ˜¯æœ€æ¬¡æœ€æ¬¡çš„é¢—ç²’å—
18:29 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] èµ·å¤œçº§æŒ‘å‰©ä¸‹æ¥çš„ç»™æ¶ˆè´¹çº§ nvme æŒ‘å‰©ä¸‹æ¥çš„ç»™ sata ç¡¬ç›˜æŒ‘å‰©ä¸‹æ¥çš„ç»™ U ç›˜
18:29 <digua> gauge, ç”¨åœ¨è½¯è·¯ç”±ä¸Š(
18:30 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] ï¼Ÿä½ è½¯è·¯ç”±è¿˜ zfs
18:30 <nichi_bot> [Kimiblock Moe] U ç›˜ä¸å°±æ‹¿æ¥åˆ· archiso å˜›
18:30 <nichi_bot> [Kimiblock Moe] é™¤æ­¤ä»¥å¤–è¿˜æœ‰å•¥ç”¨å•Š
18:30 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] æˆ‘ä»¥ä¸º j1900 è·‘ esxi å’Œ pve å·²ç»å¤Ÿç¦»è°±äº†
18:31 <digua> å¼„ç€ç©å‘€
18:31 <HoroBot> ğŸ‹ğŸ™ˆğŸ°ğŸ™ŠğŸˆğŸŒ
18:31 <nichi_bot> [å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š] ä½ çœŸè¦å¼„çš„è¯ å»ºè®®æç‚¹ç¡¬ç›˜ç›’ç„¶åæ’ nvme
...
18:34 <nichi_bot> [Jack Smith] > <@matterbridge:nichi.co> [digua] å„ä½, æœ—ç§‘äº¬ä¸œè‡ªè¥æ——èˆ°åº— çš„Uç›˜è´¨é‡æ€ä¹ˆæ ·å•Š, æˆ‘ä¹°äº† 3 ä¸ª, ç»„ ZFS åäº†ä¿©
18:34 <nichi_bot> [Jack Smith] uç›˜ä¸å¯é ğŸ¤£
...
18:34 <nichi_bot> [Jack Smith] > <å•¥ç©æ„å•Š å’‹å›äº‹å•Š é‚£å’‹æ•´å•Š å¤§ä½¬å¸®å¸®å¿™å•Š> ï¼Ÿä½ è½¯è·¯ç”±è¿˜ zfs
18:34 <nichi_bot> [Jack Smith] æˆ‘tfå¡btrfsğŸ™ˆ
#+END_EXAMPLE
ZFS è¿™ä¸ªæŠ€æœ¯å¾ˆæ£’, ä½†å¾—ç­‰æˆ‘å¼„åˆ°é è°±çš„ç›˜...

åˆä¹°äº†ä¸¤ä¸ªæµ·åº·å¨è§†æ˜Ÿäº‘å›ºæ€ç›˜, åªä¹°ä¸¤ä¸ªæ˜¯å› ä¸ºæˆ‘æ„Ÿè§‰å°å¤„ç†å™¨å¯èƒ½è®¡ç®—æ ¡éªŒå’Œä¼šæœ‰å‹åŠ›.
è¿™å›é€Ÿåº¦å¯ä»¥, 3MB/s

å¤§é‡ IO ä»»åŠ¡è¿˜æ˜¯ä¼šé˜»å¡, å¯ä»¥ç”¨ =nq= æ’ä¸ªé˜Ÿåˆ—.


* Ref
- [[https://feng.si/posts/2019/06/freebsd-and-risc-v-the-future-of-open-source-iot-ecosystem/][FreeBSD ä¸ RISC-V: å¼€æºç‰©è”ç½‘ç”Ÿæ€ç³»ç»Ÿçš„æœªæ¥]]
- [[https://lists.freebsd.org/archives/freebsd-arm/2021-June/000149.html][freebsd-arm: FriendlyARM NanoPi R2S board support.]]
- [[https://hauweele.net/~gawen/blog/?p=2662][FreeBSD on NanoPi R2S]] æåˆ°ç½‘ç»œæœ‰æ—¶ä¼šå¡ä½, æˆ‘ä¹Ÿé‡åˆ°äº†
- å…³äº systemd æœ‰ä¸ªä¸é”™çš„è§†é¢‘: [[https://www.bilibili.com/video/BV1oo4y1x7Nw][ã€äººè‚‰ç²¾ç¿»ã€‘systemdçš„æ‚²å‰§]] [[https://youtu.be/o_AIw9bGogo][YouTube]]
- [[https://docs.freebsd.org/en/articles/rc-scripting/][Practical rc.d scripting in BSD]]
- [[https://szclsya.me/zh-cn/posts/storage/zfs-setup/][ZFS å…¥é—¨æŒ‡åŒ—ï¼šè§„åˆ’ä¸åˆ›å»ºå­˜å‚¨æ± ]]
